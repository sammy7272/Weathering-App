<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard with Charts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.6.2/chart.min.js"></script>



    <style>
        header {
            height: 64px;
            /* Set a fixed height for the header */
        }


        @media (max-width: 768px) {
            #sidebar {
                margin-top: 64px;

            }
        }

        .profile-pic {
            transition: transform 0.3s ease, filter 0.3s ease;

            filter: grayscale(100%);
            /* Grey out the image */
        }

        .profile-pic:hover {
            transform: scale(1.1);

            filter: grayscale(0%);

        }


        #sidebar {
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }




        .description {
            transition: all 0.3s ease-in-out;
            transform: translateY(20px);
            opacity: 0;
        }


        .card:hover .description {
            opacity: 1;
            transform: translateY(0);
        }


        .card {
            transition: transform 0.6s cubic-bezier(.28, -0.03, 0, .99);
        }


        .header-day {
            background-color: rgba(13, 146, 244, 0.1);
            /* Day color with opacity intact */
        }

        .header-night {
            background-color: rgba(24, 1, 97, 0.1);

        }


        #forecastBody tr {
            background-color: rgba(130, 162, 185, 0.2);

        }


        /* Hover to scale the card */
        .card:hover {
            transform: scale(1.05);
        }

        body {
            perspective: 1000px;
        }

        /* Card styling */
        .card {
            transform-style: preserve-3d;
            transition: transform 1s ease-in-out;
        }


        .card:hover {
            transform: rotateY(180deg);
        }


        .card-img {
            transform: translateZ(40px);
            position: relative;
        }


        .dark-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            /* 50% opacity for darkening */
            z-index: 1;
        }


        .content-front {
            z-index: 2;
        }


        .card-body {
            transform: rotateY(180deg);
            backface-visibility: hidden;
        }


        .content-back,
        .content-front {
            backface-visibility: hidden;
        }

        /* Hover effects for content back */
        .content-back {
            opacity: 0;
            transition: opacity 1s ease;
        }

        .card:hover .content-back {
            opacity: 1;
            transition-delay: 0.3s;
        }

        .card:hover .content-front {
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        /* Fix background animation flicker */
        .card-body,
        .card-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        #sendButton {
            background-color: rgba(55, 55, 55, 0.8);

            padding: 10px;
            border-radius: 10px;

            transition: background-color 0.3s ease;

        }

        #sendButton:hover {
            background-color: rgba(55, 55, 55, 1);

        }


        .bg {
            position: absolute;
            background: #fff;
            border-radius: 100px;
            width: 0%;
            transition: width 0.5s;
        }

        .bg:nth-child(1) {
            height: 25%;
            transform-origin: left;
            top: 0;
            left: -10%;

            transform: rotate(-10deg);
        }

        .bg:nth-child(2) {
            height: 50%;
            transform-origin: right;
            top: 5%;
            right: -10%;

            transform: rotate(-10deg);
        }

        .bg:nth-child(3) {
            height: 50%;
            transform-origin: left;
            top: 70%;
            left: -10%;

            transform: rotate(-10deg);
        }


        .card:hover .bg {
            width: 100%;

            transition-delay: 1s;
        }

        .card:hover .bg:nth-child(2) {
            transition-delay: 1.5s;
        }

        .card:hover .bg:nth-child(3) {
            transition-delay: 2s;
        }


        .card-body {
            transform: translateZ(-40px) scale(0.9);

            background: transparent;

            border: 4px solid #fff;

        }

        #background,
        #sectionVideo {
            transition: opacity 0.5s ease-in-out;

        }

        #background {
            transition: background-image 0.5s ease-in-out, background-color 0.5s ease-in-out;
            background-size: cover;
            height: 100vh;

        }
    </style>
</head>

<body class="bg-gray-700 text-white flex h-screen overflow-hidden">
    <div id="background" class="fixed inset-0 z-0 bg-cover bg-center filter blur-sm">
        <img id="backgroundImage" src="media/sunny2.gif" alt="Day Background"
            class="absolute inset-0 w-full h-full object-cover" style="opacity: 1;">
        <img id="newBackgroundImage" src="media/nightgif.gif" alt="Night Background"
            class="absolute inset-0 w-full h-full object-cover" style="opacity: 0;"> <!-- Initially hidden -->
    </div>
    <aside
        class="w-64 bg-[#0D92F4] bg-opacity-20 backdrop-blur-lg text-white h-full p-4 fixed md:relative transition-transform transform md:translate-x-0 -translate-x-full z-40 mt-16 md:mt-0 shadow-xl"
        id="sidebar">
        <div class="text-center mb-10">
            <h1 class="text-2xl font-bold">Menu</h1>
        </div>
        <nav>
            <ul>
                <li class="mb-4">
                    <a href="index.html" id="dashboardLink"
                        class="block py-2 px-4 border border-[#0D92F4] border-opacity-100 rounded transition-all duration-300 text-sm md:text-base hover:bg-[#0D92F4] hover:bg-opacity-50">
                        Dashboard
                    </a>
                </li>
                <li>
                    <a href="Table.html" id="tablesLink"
                        class="block py-2 px-4 border border-[#0D92F4] border-opacity-100 rounded transition-all duration-300 text-sm md:text-base hover:bg-[#0D92F4] hover:bg-opacity-50">
                        Tables
                    </a>
                </li>
            </ul>
        </nav>
    </aside>





    <!-- Header -->
    <div class="flex-1 flex flex-col overflow-hidden">
        <header id="appHeader"
        class="p-4 flex items-center z-50 shadow-md fixed w-full top-0 left-0 right-0 bg-[#0D92F4] bg-opacity-10 backdrop-blur-lg">
    <div class="flex items-center">
        <button id="menuButton" class="mr-4 md:hidden" onclick="toggleSidebar()">
            <span class="text-2xl">&#9776;</span>
        </button>
        <img src="media/logo.gif" alt="App Logo" class="w-20 h-20 mr-2 mt-3"> 

        <h1 class="text-xl font-bold pr-7">Weathering App</h1>
    </div>
    <div class="flex-grow mx-4 mt-6 md:mt-0">
        <input type="text" id="cityInput" placeholder="Search City"
               class="w-full px-4 py-2 rounded-lg border border-[#0D92F4] bg-transparent text-white placeholder-white focus:bg-white focus:text-gray-700 transition-all duration-300"
               onclick="this.classList.add('bg-white');" onblur="this.classList.remove('bg-white');">
    </div>
    <button id="searchButton" class="search-button px-4 py-2 border border-[#0D92F4] rounded mr-4 bg-transparent text-white 
           hover:bg-[#0D92F4] hover:text-white transition-all duration-300" onclick="fetchWeatherData()">
        Search
    </button>

    <div class="w-12 h-12 bg-gray-400 rounded-full flex items-center justify-center bg-cover bg-center profile-pic"
         style="background-image: url('media/me.jpg');"></div>
</header>








        <!-- Main Content -->
        <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-700 p-4 pt-16">
            <section id="gifSection"
                class="relative mb-8 mt-12 shadow-xl rounded-lg overflow-hidden transition-transform duration-300 hover:scale-105 h-96">
                <img id="sectionImage" src="media/sunny2.gif" alt="Day Section"
                    class="absolute inset-0 w-full h-full object-cover" style="opacity: 1;">
                <img id="newSectionImage" src="media/nightgif.gif" alt="Night Section"
                    class="absolute inset-0 w-full h-full object-cover" style="opacity: 0;"> <!-- Initially hidden -->

                <div class="absolute inset-0 bg-black opacity-0 hover:opacity-20 transition-opacity duration-300 z-10">
                </div>

                <div id="gifText"
                    class="relative z-20 text-center p-16 bg-black bg-opacity-50 text-white h-full flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity duration-300">
                    <h1 id="mainText" class="text-5xl font-bold">Tables Page</h1>
                </div>
            </section>




            <div id="forecastTable">


                <!-- Toggle Button -->
                <div class="flex justify-between mb-4">




                </div>
                <div class="flex flex-wrap justify-between"> <!-- Parent container with Flexbox -->

                    <!-- Forecast Table Section -->
                    <div id="forecastTableContainer" class="w-full md:w-2/3 pr-4">
                        <!-- Adjust width to 2/3 of the container -->
                        <div id="forecastTable"
                            class="bg-[#0D92F4] bg-opacity-10 backdrop-blur-md p-6 rounded-lg shadow-lg mb-6">
                            <h2 class="text-xl font-bold mb-4">5-Day Temperature Forecast</h2>

                            <!-- Toggle Button -->
                            <div class="flex flex-wrap justify-between mb-4 gap-2">
                                <div class="flex flex-wrap justify-between mb-4 gap-2">
                                    <button id="toggleDayNight"
                                        class="flex items-center justify-center w-12 h-12 bg-[#FFE6A5] rounded-full">
                                        <img src="media/sun.gif" alt="Day" class="w-8 h-8">
                                    </button>
                                </div>
                                <div class="w-full sm:w-auto">
                                    <select id="filterOptions"
                                        class="bg-[#0D92F4] bg-opacity-30 backdrop-blur-md text-white border border-[#0D92F4] px-4 py-2 rounded hover:bg-[#0D92F4] hover:bg-opacity-40 w-full sm:w-auto transition-all duration-300">
                                        <option value="none">None</option>
                                        <option value="rain">Filter Rainy Days</option>
                                        <option value="asc">Sort Ascending</option>
                                        <option value="desc">Sort Descending</option>
                                    </select>
                                </div>
                            </div>

                            <div class="overflow-auto max-h-64">
                                <table class="w-full text-left rounded-lg">
                                    <thead class="bg-opacity-30 text-sm md:text-base">
                                        <tr>
                                            <th class="px-4 py-2 bg-[#0D92F4] bg-opacity-20 backdrop-blur-lg">Date</th>
                                            <th class="px-4 py-2 bg-[#0D92F4] bg-opacity-20 backdrop-blur-lg"
                                                id="tempHeader">Temperature (°C)</th>
                                            <th class="px-4 py-2 bg-[#0D92F4] bg-opacity-20 backdrop-blur-lg">Weather
                                                Condition</th>
                                            <th class="px-4 py-2 bg-[#0D92F4] bg-opacity-20 backdrop-blur-lg">Icon</th>
                                        </tr>
                                    </thead>
                                    <tbody id="forecastBody" class="bg-opacity-20">
                                        <!-- Dynamic data rows will be inserted here -->
                                    </tbody>
                                </table>
                            </div>
                            <!-- Pagination Controls -->
                            <div class="flex justify-between items-center mt-4" id="paginationControls">
                                <button id="prevButton"
                                    class="bg-[#0D92F4] bg-opacity-20 backdrop-blur-lg px-4 py-2 rounded transition-all duration-300 hover:bg-[#0D92F4] hover:bg-opacity-40 hover:scale-105">
                                    Previous
                                </button>
                                <button id="nextButton"
                                    class="bg-[#0D92F4] bg-opacity-20 backdrop-blur-lg px-4 py-2 rounded transition-all duration-300 hover:bg-[#0D92F4] hover:bg-opacity-40 hover:scale-105">
                                    Next
                                </button>
                            </div>
                        </div>
                    </div>


                    <!-- Chatbot Section -->
                    <div id="chatbotContainer" class="w-full md:w-1/3 mt-6 md:mt-0">
                        <!-- Full width on small screens, 1/3 on larger -->
                        <div id="chatbot" style="background-color: rgba(13, 146, 244, 0.3);"
                        class="backdrop-blur-md p-6 rounded-lg shadow-lg h-full">
                        <div class="mb-4 flex items-center">
                            <!-- Adjusted Logo Size -->
                            <img src="media/gemini.png" alt="Gemini Logo" class="mr-4 w-20 h-auto"> <!-- Adjust width here -->
                        
                        </div>
                        <div class="mb-4">
                            <div id="chatLog" style="background-color: rgba(130, 162, 185, 0.2); height: 16rem;"
                                class="p-4 rounded overflow-auto mb-2 text-white">
                                <!-- Messages will be added dynamically -->
                            </div>
                            <div class="flex items-center">
                                <input type="text" id="chatInput" placeholder="Ask a question..."
                                    class="flex-grow px-4 py-2 rounded-lg border-2 border-gray-600 bg-gray-800 text-white bg-opacity-70 backdrop-blur-sm">
                    
                                <!-- Icon Button for Send, with onclick attribute -->
                                <button id="sendButton"
                                    class="ml-2 bg-gray-700 p-2 rounded-lg hover:bg-gray-600 transition-all duration-200"
                                    onclick="sendMessage()">
                                    <img src="media/send.png" alt="Send" class="w-6 h-6">
                                </button>
                            </div>
                        </div>
                    </div>
                    



                    </div>



        </main>
</body>




<script>
    const apiKey = '4864395c986b99fc97e6db8616df6a6a';
    const geminiApiKey = 'AIzaSyAZbB37PF54HAPJoQLRr6QGkE5R6mri6a4';
    let forecastData = []; // To store forecast data for the table
    let currentPage = 1;
    const entriesPerPage = 10;
    let showDayTemps = true;
    let isRainFiltered = false;




    displayForecastTable();

    function fetchWeatherData() {
        const city = document.getElementById('cityInput').value;
        if (!city) {
            alert('Please enter a city name');
            return;
        }
        const forecastUrl = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric`;

        fetch(forecastUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('City not found');
                }
                return response.json();
            })
            .then(data => {
                forecastData = data.list;
                currentPage = 1;
                displayForecastTable();
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                document.getElementById('forecastBody').innerHTML = `<tr><td colspan="4" class="px-4 py-2 text-red-600">${error.message}</td></tr>`;
            });
    }

    function sortForecastData(order = 'asc') {
        forecastData.sort((a, b) => {
            const tempA = a.main.temp;
            const tempB = b.main.temp;

            return order === 'asc' ? tempA - tempB : tempB - tempA;
        });
    }


    function getWeather() {
        const apiKey = '4864395c986b99fc97e6db8616df6a6a';
        const city = 'Islamabad';
        const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`;

        fetch(url)
            .then(response => response.json())
            .then(data => displayCurrentWeather(data))
            .catch(error => console.error('Error fetching weather data:', error));
    }
    function formatWeatherResponse(data) {
        const { name, main, weather } = data;
        return `The current weather in ${name} is ${weather[0].description}. The temperature is ${main.temp}°C with a humidity of ${main.humidity}%.`;
    }
    // Toggle between day and night temperatures
    document.getElementById('toggleDayNight').onclick = () => {
        showDayTemps = !showDayTemps; // Toggle state
        const toggleButton = document.getElementById('toggleDayNight');
        const background = document.getElementById("background");


        if (showDayTemps) {
            toggleButton.innerHTML = '<img src="media/sun.gif" alt="Day" class="w-8 h-8">';
            toggleButton.className = "flex items-center justify-center w-12 h-12 bg-[#FFE6A5] rounded-full"; // Day color
            background.style.backgroundImage = "url('media/sunny2.gif')"; // Set day background
        } else {
            toggleButton.innerHTML = '<img src="media/night.gif" alt="Night" class="w-8 h-8">';
            toggleButton.className = "flex items-center justify-center w-12 h-12 bg-[#474F7A] rounded-full"; // Night color
            background.style.backgroundImage = "url('media/nightgif.gif')";
        }

        // Add fade transition
        background.style.transition = 'background-image 0.5s ease-in-out';
        displayForecastTable(); // Refresh table with new temperatures
    };


    document.getElementById('toggleDayNight').onclick = () => {
        showDayTemps = !showDayTemps; // Toggle state
        document.getElementById('toggleDayNight').textContent = showDayTemps ? 'Show Night Temperatures' : 'Show Day Temperatures';
        displayForecastTable();
    };


    document.getElementById('filterOptions').addEventListener('change', (event) => {
        const filterValue = event.target.value;
        isRainFiltered = filterValue === 'rain';

        // Sort data if "Sort Ascending" or "Sort Descending" is selected
        if (filterValue === 'asc') {
            sortForecastData('asc');
        } else if (filterValue === 'desc') {
            sortForecastData('desc');
        }

        displayForecastTable();
    });

    // Function to sort forecast data
    function displayForecastTable() {
        const tableBody = document.getElementById('forecastBody');
        tableBody.innerHTML = ''; // Clear previous entries

        const filteredData = isRainFiltered ?
            forecastData.filter(item => item.weather[0].main.toLowerCase() === 'rain') :
            forecastData;

        if (filteredData.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="4" class="px-4 py-2 text-red-600">No forecast data available.</td></tr>`;
            updatePaginationControls(0); // Update pagination controls
            return;
        }

        const startIndex = (currentPage - 1) * entriesPerPage;
        const endIndex = startIndex + entriesPerPage;
        const currentEntries = filteredData.slice(startIndex, endIndex);

        currentEntries.forEach(item => {
            const date = new Date(item.dt * 1000).toLocaleDateString();
            const dayTemp = item.main.temp_max.toFixed(1);
            const nightTemp = item.main.temp_min.toFixed(1);
            const condition = item.weather[0].main;

            const tempToShow = showDayTemps ? dayTemp : nightTemp;


            let conditionIcon;
            switch (condition.toLowerCase()) {
                case 'clear':
                    conditionIcon = 'media/sun.gif';
                    break;
                case 'rain':
                    conditionIcon = 'media/rain.gif';
                    break;
                case 'snow':
                    conditionIcon = 'media/snw.gif';
                    break;
                default:
                    conditionIcon = 'media/cloud.gif'; // Default to cloud if no specific match
            }

            const rowHtml = `
            <tr class="bg-gray-700 hover:bg-gray-600">
                <td class="px-4 py-2">${date}</td>
                <td class="px-4 py-2">${tempToShow}°C</td>
                <td class="px-4 py-2">${condition}</td>
                <td class="px-4 py-2">
                    <img src="${conditionIcon}" alt="${condition}" class="max-w-[50px] max-h-[50px] object-contain">
                </td>
            </tr>
        `;
            tableBody.innerHTML += rowHtml;
        });

        updatePaginationControls(filteredData.length); // Update pagination based on the filtered data
    }

    // Update pagination controls function remains unchanged
    function updatePaginationControls(totalEntries) {
        const totalPages = Math.ceil(totalEntries / entriesPerPage);
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');

        prevButton.disabled = currentPage === 1;
        nextButton.disabled = currentPage === totalPages;

        prevButton.onclick = () => {
            if (currentPage > 1) {
                currentPage--;
                displayForecastTable();
            }
        };

        nextButton.onclick = () => {
            if (currentPage < totalPages) {
                currentPage++;
                displayForecastTable();
            }
        };
    }

    // Chatbot Functionality
    async function fetchGeminiResponse(userMessage) {
        try {
            // Check if the message is weather-related
            if (userMessage.toLowerCase().includes('weather')) {
                const city = extractCity(userMessage);
                if (!city) {
                    return "I'm sorry, I couldn't determine which city you're asking about. Can you please specify the city?";
                }
                const weatherData = await fetchWeatherData2(city);
                return formatWeatherResponse(weatherData);
            }

            // For non-weather queries, use Gemini API
            console.log('Sending request to Gemini API...');
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${geminiApiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [
                        {
                            parts: [
                                { text: userMessage }
                            ]
                        }
                    ]
                }),
            });

            console.log('Gemini API response status:', response.status);

            if (!response.ok) {
                throw new Error(`Error fetching response from Gemini API: ${response.status} ${response.statusText}`);
            }

            const data = await response.json();
            console.log('Gemini API response data:', data);

            // Check for a valid response structure
            if (!data.candidates || !Array.isArray(data.candidates) || data.candidates.length === 0 ||
                !data.candidates[0].content || !Array.isArray(data.candidates[0].content.parts) || data.candidates[0].content.parts.length === 0) {
                throw new Error('Invalid response structure from Gemini API');
            }

            return data.candidates[0].content.parts[0].text;
        } catch (error) {
            console.error('Error in fetchGeminiResponse:', error);
            return 'Error: Unable to process your request at this moment.';
        }
    }

    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('-translate-x-full'); // Toggle the sidebar visibility
    }

    // Close sidebar when clicking outside
    document.addEventListener('click', (event) => {
        const sidebar = document.getElementById('sidebar');
        const menuButton = document.getElementById('menuButton');


        if (!sidebar.contains(event.target) && !menuButton.contains(event.target) && !sidebar.classList.contains('-translate-x-full')) {
            sidebar.classList.add('-translate-x-full'); // Close the sidebar
        }
    });






    function sendMessage() {
        const chatInput = document.getElementById('chatInput');
        const userMessage = chatInput.value.trim();
        chatInput.value = ''; // Clear input field

        if (!userMessage) {
            return; // Don't send empty messages
        }


        const chatLog = document.getElementById('chatLog');
        chatLog.innerHTML += `
    <div class="flex items-center mb-2">
        <div class="w-10 h-10 rounded-full bg-cover bg-center" style="background-image: url('media/me.jpg');"></div>
        <div class="ml-2 rounded-lg bg-[#77CDFF] bg-opacity-70 p-2 text-white">
            ${userMessage}
        </div>
    </div>`;

        // Show loading message
        const loadingId = Date.now();
        chatLog.innerHTML += `<div id="loading-${loadingId}" class="text-blue-400">Gemini: Thinking...</div>`;


        chatLog.scrollTop = chatLog.scrollHeight;


        const city = extractCity(userMessage);
        if (city) {
            fetchWeatherData2(city)
                .then(weatherData => {
                    document.getElementById(`loading-${loadingId}`).remove();
                    const weatherResponse = formatWeatherResponse(weatherData);
                    chatLog.innerHTML += `
                <div class="flex justify-end items-center mb-2"> <!-- Align to right -->
                    <div class="ml-2 rounded-lg bg-gray-800 bg-opacity-70 p-2 text-blue-400">
                        ${weatherResponse}
                    </div>
                    <div class="w-10 h-10 rounded-full bg-cover bg-center" style="background-image: url('media/gemini.jpg');"></div>
                </div>`;
                    chatLog.scrollTop = chatLog.scrollHeight; // Scroll to the bottom
                })
                .catch(error => {
                    document.getElementById(`loading-${loadingId}`).remove();
                    chatLog.innerHTML += `
                <div class="flex justify-end items-center mb-2"> <!-- Align to right -->
                    <div class="ml-2 rounded-lg bg-red-600 bg-opacity-70 p-2 text-white">
                        Error: Could not retrieve weather data. Please try again.
                    </div>
                    <div class="w-10 h-10 rounded-full bg-cover bg-center" style="background-image: url('media/gemini.jpg');"></div>
                </div>`;
                });
        } else {
            // Default Gemini API response for non-weather-related questions
            fetchGeminiResponse(userMessage)
                .then(responseText => {
                    document.getElementById(`loading-${loadingId}`).remove();
                    chatLog.innerHTML += `
                <div class="flex justify-end items-center mb-2"> <!-- Align to right -->
                    <div class="ml-2 rounded-lg bg-gray-800 bg-opacity-70 p-2 text-blue-400">
                        ${responseText}
                    </div>
                    <div class="w-10 h-10 rounded-full bg-cover bg-center" style="background-image: url('media/gemini.jpg');"></div>
                </div>`;
                    chatLog.scrollTop = chatLog.scrollHeight; // Scroll to the bottom
                })
                .catch(error => {
                    document.getElementById(`loading-${loadingId}`).remove();
                    chatLog.innerHTML += `
                <div class="flex justify-end items-center mb-2"> <!-- Align to right -->
                    <div class="ml-2 rounded-lg bg-red-600 bg-opacity-70 p-2 text-white">
                        Error: An error occurred while processing your request. Please try again.
                    </div>
                    <div class="w-10 h-10 rounded-full bg-cover bg-center" style="background-image: url('media/gemini.jpg');"></div>
                </div>`;
                });
        }
    }



    function extractCity(userMessage) {
        const regex = /(?:weather in|forecast for)\s(\w+)/i;
        const match = userMessage.match(regex);
        return match ? match[1] : null;
    }

    async function fetchWeatherData2(city) {
        const apiKey = '4864395c986b99fc97e6db8616df6a6a'; // Your API key
        const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`;

        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error('City not found'); // Error handling for invalid city
            }

            const data = await response.json();
            console.log('Weather data:', data);


            return {
                city: data.name, // City name
                temperature: data.main.temp,
                condition: data.weather[0].description
            };
        } catch (error) {
            console.error('Error fetching weather data:', error);
            throw error; // Pass the error for further handling
        }
    }


    // Function to format the weather data for the chat response
    function formatWeatherResponse(weatherData) {
        return `The current weather in ${weatherData.city} is ${weatherData.temperature}°C with ${weatherData.condition}.`;
    }








    document.getElementById('toggleDayNight').onclick = () => {
        showDayTemps = !showDayTemps; // Toggle day/night state
        const toggleButton = document.getElementById('toggleDayNight');

        // Define day and night colors (with opacity intact)
        const dayColor = 'rgba(13, 146, 244, 0.1)'; // Day color with low opacity
        const nightColor = 'rgba(24, 1, 97, 0.1)'; // Night color with low opacity

        const dayRowColor = 'rgba(13, 146, 244, 0.2)'; // Day row color with low opacity
        const nightRowColor = 'rgba(24, 1, 97, 0.2)'; // Night row color with low opacity

        const backgroundImage = document.getElementById('backgroundImage');
        const newBackgroundImage = document.getElementById('newBackgroundImage');
        const sectionImage = document.getElementById('sectionImage');
        const newSectionImage = document.getElementById('newSectionImage');

        // Update the colors based on the selected mode (day or night)
        const currentColor = showDayTemps ? '#0D92F4' : '#6256CA';
        const sidebarColor = `bg-[${currentColor}] bg-opacity-20`;
        const borderColor = `border-[${currentColor}]`;
        const hoverColor = `hover:bg-[${currentColor}] hover:bg-opacity-50`;

        // Update button image and add border color
        toggleButton.innerHTML = showDayTemps
            ? '<img src="media/sun.gif" alt="Day" class="w-8 h-8">'
            : '<img src="media/night.gif" alt="Night" class="w-8 h-8">';
        toggleButton.className = `flex items-center justify-center w-12 h-12 bg-[${currentColor}] border ${borderColor} rounded-full transition-all duration-300`;

        // Update background and section images
        newBackgroundImage.src = showDayTemps ? "media/sunny2.gif" : "media/nightgif.gif";
        newSectionImage.src = showDayTemps ? "media/sunny2.gif" : "media/nightgif.gif";

        // Fade transition for background and section images
        backgroundImage.style.opacity = 1;
        newBackgroundImage.style.opacity = 0;
        sectionImage.style.opacity = 1;
        newSectionImage.style.opacity = 0;

        setTimeout(() => {
            backgroundImage.style.transition = 'opacity 1s ease';
            backgroundImage.style.opacity = 0;
            newBackgroundImage.style.transition = 'opacity 1s ease';
            newBackgroundImage.style.opacity = 1;

            sectionImage.style.transition = 'opacity 1s ease';
            sectionImage.style.opacity = 0;
            newSectionImage.style.transition = 'opacity 1s ease';
            newSectionImage.style.opacity = 1;
        }, 100);

        // Update sidebar background, link, and hover colors
        document.getElementById('sidebar').className = `w-64 ${sidebarColor} backdrop-blur-lg text-white h-full p-4 fixed md:relative transition-transform transform md:translate-x-0 -translate-x-full z-40 mt-16 md:mt-0 shadow-xl`;

        const dashboardLink = document.getElementById('dashboardLink');
        dashboardLink.className = `block py-2 px-4 border ${borderColor} border-opacity-100 rounded transition-all duration-300 ${hoverColor}`;

        const tablesLink = document.getElementById('tablesLink');
        tablesLink.className = `block py-2 px-4 border ${borderColor} border-opacity-100 rounded transition-all duration-300 ${hoverColor}`;

        const searchButton = document.getElementById('searchButton');
        searchButton.className = `search-button px-4 py-2 border ${borderColor} rounded mr-4 bg-[${currentColor}] text-white transition-all duration-300`;

        const cityInput = document.getElementById('cityInput');
        cityInput.className = `w-full px-4 py-2 rounded-lg border-[${currentColor}] bg-transparent text-white placeholder-white focus:border-[${currentColor}] focus:bg-white focus:text-gray-700 transition-all duration-300`;

        // Change the header background color but preserve opacity (using rgba)
        const appHeader = document.getElementById('appHeader');
        appHeader.style.backgroundColor = showDayTemps ? dayColor : nightColor;

        // Update table rows based on the current mode
        updateTableRows(showDayTemps);

        // Optional: Refresh the table with new temperatures
        displayForecastTable();
    };

    // Function to update the table rows based on the current mode
    function updateTableRows(isDayMode) {
        const rows = document.querySelectorAll('#forecastBody tr');
        const rowColor = isDayMode ? 'rgba(13, 146, 244, 0.2)' : 'rgba(24, 1, 97, 0.2)'; // Row colors for day and night

        rows.forEach(row => {
            row.style.backgroundColor = rowColor; // Set the row background color
        });
    }

    // Ensure the button has an initial border when the page loads
    window.onload = () => {
        const toggleButton = document.getElementById('toggleDayNight');
        const dayColor = '#0D92F4';
        const nightColor = '#6256CA';

        const currentColor = showDayTemps ? dayColor : nightColor;
        const borderColor = showDayTemps ? `border-[${dayColor}]` : `border-[${nightColor}]`;

        toggleButton.className = `flex items-center justify-center w-12 h-12 bg-[${currentColor}] border ${borderColor} rounded-full transition-all duration-300`;
    };






    function displayCurrentWeather(data) {
        const { name, main, wind, weather } = data;
        const weatherCondition = weather[0].main.toLowerCase(); // Get the weather condition in lowercase
        const isDayTime = showDayTemps; // Use the toggle state for determining colors




        // Update the header background color and border color
        const appHeader = document.getElementById('appHeader');
        appHeader.className = `p-4 flex items-center z-50 shadow-md fixed w-full top-0 left-0 right-0 ${headerColor} ${borderColor} backdrop-blur-lg transition-all duration-300`;

        // Update sidebar background color
        const sidebar = document.getElementById('sidebar');
        sidebar.className = `w-64 ${sidebarColor} backdrop-blur-lg text-white h-full p-4 fixed md:relative transition-transform transform md:translate-x-0 -translate-x-full z-40 mt-16 md:mt-0 shadow-xl`;

        // Update the table background color
        const tableWrapper = document.querySelector('.overflow-auto'); // Assuming you have the overflow-auto class for the table wrapper
        tableWrapper.className = `overflow-auto max-h-64 ${tableBackgroundColor}`; // Update the table background color

        // Update sidebar link border colors and hover effects
        const dashboardLink = document.getElementById('dashboardLink');
        dashboardLink.className = `block py-2 px-4 border ${borderColor} border-opacity-100 rounded transition-all duration-300 ${sidebarHoverColor}`;

        const tablesLink = document.getElementById('tablesLink');
        tablesLink.className = `block py-2 px-4 border ${borderColor} border-opacity-100 rounded transition-all duration-300 ${sidebarHoverColor}`;

        // Update the search button styles
        const searchButton = document.getElementById('searchButton');
        searchButton.className = `search-button px-4 py-2 border ${borderColor} rounded mr-4 ${buttonHoverColor} text-white transition-all duration-300`;

        // Update the search bar border color
        const cityInput = document.getElementById('cityInput');
        cityInput.className = `w-full px-4 py-2 rounded-lg ${searchBarBorderColor} bg-transparent text-white placeholder-white focus:${searchBarBorderColor} focus:bg-white focus:text-gray-700 transition-all duration-300`;

        // Create the weather info structure with flexbox
        const weatherInfo = `
        <div class="weather-details">
            <h2>${name}</h2>
            <p>Temperature: ${main.temp} °C</p>
            <p>Wind Speed: ${wind.speed} m/s</p>
            <p>Condition: ${weatherCondition}</p>
        </div>
    `;

        // Update the current weather section with the new weather info
        document.getElementById('currentWeather').innerHTML = weatherInfo;
    }



    function changeBackgroundGif(newGifUrl) {
        const background = document.getElementById('background');
        background.style.transition = ''; // Remove any transition effect
        background.style.backgroundImage = `url('${newGifUrl}')`; // Immediately change the background image
    }



    // Call the getWeather function on page load
    window.onload = getWeather;    
</script>
</body>

</html>